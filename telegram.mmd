graph TD
  Start[/Пользователь вводит /start/] --> Welcome[Приветствие и информация о балансе]
  Welcome --> Menu{Главное меню}
  
  Menu --> Devices[/Мои устройства/]
  Menu --> AddDevice[/Добавить устройство/]
  Menu --> RemoveDevice[/Удалить устройство/]
  Menu --> Invite[/Пригласить друга/]
  Menu --> Help[/Помощь/]
  Menu --> Privacy[/Конфиденциальность/]

  Devices --> ShowDevices[Показать список устройств с типами и ID]
  ShowDevices --> DeviceLink[Получить ссылку для настройки]

  AddDevice --> AddWarning[Предупреждение о стоимости]
  AddWarning --> DeviceType{Выберите тип устройства}
  DeviceType --> iOS[iPhone/iPad]
  DeviceType --> Android[Android]
  DeviceType --> Comp[Компьютер]
  DeviceType --> TV[Android TV]

  Comp --> OSChoice{Mac или Windows}
  OSChoice --> Mac[MacOS]
  OSChoice --> Windows[Windows]

  iOS --> GenLink[Генерация ссылки и инструкция]
  Android --> GenLink
  Mac --> GenLink
  Windows --> GenLink
  TV --> GenLink

  RemoveDevice --> DeviceList[Выбор устройства из списка]
  DeviceList --> RemoveConfirm[Подтверждение удаления]
  RemoveConfirm --> Check24h{Проверка: >24ч с момента добавления?}
  Check24h -- Нет --> BlockRemove[Ошибка: нельзя удалить]
  Check24h -- Да --> VPNCheck[Предупреждение: отключите VPN]
  VPNCheck --> RemoveSuccess[Удалено + обновление баланса]
  RemoveSuccess --> LastDeviceCheck{Последнее устройство?}
  LastDeviceCheck -- Да --> FreezeCharges[Остановка списаний]
  LastDeviceCheck -- Нет --> Menu

  Invite --> GenRefLink[Генерация реферальной ссылки]
  GenRefLink --> ShowRef[Условия: +50₽ / +100₽ другу]

  Help --> Topics{Выбор темы}
  Topics --> Topic1[VPN не работает]
  Topics --> Topic2[Инструкция по установке]
  Topics --> Topic3[Не могу найти ссылку]
  Topics --> Topic4[Низкая скорость]
  Topics --> Topic5[Телевизор (Android TV)]
  Topics --> Topic6[Заморозка баланса]
  Topics --> Topic7[Альтернативный протокол]

  Privacy --> Policy[Описание политики конфиденциальности]

  style Start fill:#e0f7fa,stroke:#00acc1,stroke-width:2px
  style Menu fill:#f1f8e9
  style Devices,AddDevice,RemoveDevice,Invite,Help,Privacy fill:#fff3e0
  style ShowDevices,AddWarning,DeviceType,DeviceList,GenRefLink,Topics fill:#e3f2fd
  style Welcome fill:#dcedc8
